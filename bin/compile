#!/bin/sh

BUILD_DIR=$1

echo "-----> Installing Ollama..."

# Download and install Ollama binary
puts_step "Fetching and vendoring Ollama into slug"
curl -L https://ollama.ai/download/ollama-linux-amd64 -o /tmp/ollama
chmod +x /tmp/ollama

# Move the binary to the build directory
mkdir -p $BUILD_DIR/.heroku/ollama
mv /tmp/ollama $BUILD_DIR/.heroku/ollama/

# Add binary to PATH
mkdir -p "$BUILD_DIR/.profile.d"
echo 'export PATH="$PATH:$HOME/.heroku/ollama/"' >> $BUILD_DIR/.profile.d/ollama.sh
chmod +x "$BUILD_DIR/.profile.d/ollama.sh"

"$BUILD_DIR/.heroku/ollama" -v
echo "-----> Ollama installation done"
